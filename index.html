<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css" />

    <title>ã‚¿ã‚¤ãƒãƒ¼</title>
</head>

<body>

    <!-- jqueryèª­ã¿è¾¼ã¿ -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    <!-- ãƒ­ã‚°ã‚¤ãƒ³è€…æƒ…å ± -->
    <h1>realtime chat</h1>
    <!-- <p><img id="prof"></p> ã“ã“ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒè¡¨ç¤ºã•ã›ãŸã„ï¼ï¼…ï¼…ï¼…ï¼…ï¼…ï¼…ï¼…ï¼…ï¼…ï¼…ï¼…ï¼…ï¼…ï¼…ï¼…ï¼…ï¼…ï¼…ï¼… -->
    <li>ãƒ­ã‚°ã‚¤ãƒ³è€…ï¼š<span id="uname"></span></li>
    <li><img src="" id="prof"></li>


    <!-- è¡¨ç¤ºç”»é¢ -->

    <h1 id="time">çµŒéæ™‚é–“</h1>

    <p>åˆè¨ˆä½•åˆ†ã—ã¾ã™ã‹ï¼Ÿ</p>
    <input type="text" id="sec">åˆ†
    <p>ä¼‘æ†©æ™‚é–“ã¯ï¼Ÿ</p>
    <input type="text" id="break_time">åˆ†

    <button id="start">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>


    <!-- ã‚µã‚¦ãƒ³ãƒ‰ -->
    <audio src="yukkuri.mp3" id="sound_01"></audio>
    <audio src="hayame.mp3" id="sound_02"></audio>




    <div class="ctrl">
        <div class="progressCircle">
            <svg viewBox="0 0 100 100">
                <circle cx="50" cy="50" r="50" class="base" />
                <circle cx="50" cy="50" r="25" class="circle" />
            </svg>
        </div>
        <div class="progressBarInfo"><span class="minute"></span>:<span class="second"></span></div>
    </div>
    <button id="break_btn">ä¼‘æ†©ã™ã‚‹</button>

    <script>

        // ################# ã€€ï¼’ãƒ©ã‚¦ãƒ³ãƒ‰ç›®ã€ã‚¿ã‚¤ãƒãƒ¼å††ã®è‰²ãŒé»„è‰²ã®ã¾ã¾ã«ãªã‚‹ã®ä¿®æ­£ã™ã‚‹ã€€ã€€##################
        // ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®èª­ã¿è¾¼ã¿å¾Œã«jQueryã‚’ä½¿ç”¨ã™ã‚‹
        $(document).ready(function () {


            // ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸã‚‰ã€ã‚¿ã‚¤ãƒãƒ¼ã‚’é–‹å§‹ã•ã›ã‚‹ã€‚
            $(start.onclick = function () {

                function timer() {
                    // å…¥åŠ›ã•ã‚ŒãŸæ™‚é–“ã‚’å–å¾—ã™ã‚‹(ã‹ã‘ã‚‹60ã‚’ã—ã¦ã€å€¤ã‚’åˆ†ã«å¤‰æ›ã™ã‚‹)
                    const sec = $("#sec").val() * 60;
                    console.log(sec);

                    //ä½•åˆ†ã‚¿ã‚¤ãƒãƒ¼ã«ã™ã‚‹ã‹ã‚’ã“ã“ã§å®šç¾©
                    var setTime = sec;

                    // ã‚¿ã‚¤ãƒãƒ¼ã®çµŒéç§’æ•°ã‚’åˆæœŸåŒ–
                    var second = 0;

                    // å††å½¢ã®é€²æ—ãƒãƒ¼ã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é©ç”¨ã™ã‚‹ãŸã‚ã«ã€.pieã‚¯ãƒ©ã‚¹ã«pieã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
                    $('.circle').removeClass('break_time_pie').addClass('pie');
                    //â†‘removeClass ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¦æ—¢å­˜ã®ã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤ã—ã¦ã‹ã‚‰addClassã—ãªã„ã¨è‰²ãŒå¤‰ã‚ã‚‰ãªã‹ã£ãŸ
                    // $('.circle').addClass('pie');


                    // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®æ™‚é–“ã‚’è¨­å®šç§’æ•°ã®2å€ã«è¨­å®š
                    $('.circle').css({ 'animation': 'pie ' + setTime * 2 + 's linear' })

                    // ã‚¿ã‚¤ãƒãƒ¼ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«å‡¦ç†ã‚’é–‹å§‹
                    var timerId = setInterval(function () {
                        // 1ç§’ã”ã¨ã«çµŒéç§’æ•°ã‚’æ›´æ–°
                        second += 1;

                        //ã‚‚ã—ã€ã‚¿ã‚¤ãƒãƒ¼ã®æ™‚é–“ãŒ0ç§’ä»¥ä¸‹ã«ãªã£ãŸã‚‰
                        if (second >= setTime) {

                            //éŸ³ã‚’å‡ºã™
                            sound_01.play();


                            //ã‚¿ã‚¤ãƒãƒ¼æ­¢ã‚ã‚‹
                            clearInterval(timerId);
                        }

                        // æ®‹ã‚Šæ™‚é–“ã‚’è¨ˆç®—ã—ã¦è¡¨ç¤º
                        countTime = setTime - second;
                        $('.minute').text(countTime % 3600 / 60 | 0);
                        $('.second').text(countTime % 60);

                        // 1ç§’ã”ã¨ã«ã‚¿ã‚¤ãƒãƒ¼ã‚’æ›´æ–°
                    }, 1000);
                }
                // ã‚¿ã‚¤ãƒãƒ¼é–¢æ•°ã‚’å®Ÿè¡Œ
                timer();

            });




            // ä¼‘æ†©ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸã‚‰ã€ã‚¿ã‚¤ãƒãƒ¼ã‚’é–‹å§‹ã•ã›ã‚‹ã€‚
            $(break_btn.onclick = function () {

                function timer() {
                    // // å…¥åŠ›ã•ã‚ŒãŸæ™‚é–“ã‚’å–å¾—ã™ã‚‹(ã‹ã‘ã‚‹60ã‚’ã—ã¦ã€å€¤ã‚’åˆ†ã«å¤‰æ›ã™ã‚‹)
                    const break_time = $("#break_time").val() * 60;
                    console.log(break_time);

                    //ä½•åˆ†ã‚¿ã‚¤ãƒãƒ¼ã«ã™ã‚‹ã‹ã‚’ã“ã“ã§å®šç¾©
                    var setTime = break_time;

                    // ã‚¿ã‚¤ãƒãƒ¼ã®çµŒéç§’æ•°ã‚’åˆæœŸåŒ–
                    var second = 0;

                    // å††å½¢ã®é€²æ—ãƒãƒ¼ã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é©ç”¨ã™ã‚‹ãŸã‚ã«ã€.pieã‚¯ãƒ©ã‚¹ã«pieã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
                    $('.circle').removeClass('pie').addClass('break_time_pie');
                    //â†‘removeClass ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¦æ—¢å­˜ã®ã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤ã—ã¦ã‹ã‚‰addClassã—ãªã„ã¨è‰²ãŒå¤‰ã‚ã‚‰ãªã‹ã£ãŸ
                    // $('.circle').addClass('break_time_pie');


                    // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®æ™‚é–“ã‚’è¨­å®šç§’æ•°ã®2å€ã«è¨­å®š
                    $('.circle').css({ 'animation': 'break_time_pie ' + setTime * 2 + 's linear' })

                    // ã‚¿ã‚¤ãƒãƒ¼ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«å‡¦ç†ã‚’é–‹å§‹
                    var timerId = setInterval(function () {
                        // 1ç§’ã”ã¨ã«çµŒéç§’æ•°ã‚’æ›´æ–°
                        second += 1;

                        //ã‚‚ã—ã€ã‚¿ã‚¤ãƒãƒ¼ã®æ™‚é–“ãŒ0ç§’ä»¥ä¸‹ã«ãªã£ãŸã‚‰
                        if (second >= setTime) {

                            //éŸ³ã‚’å‡ºã™
                            sound_02.play();

                            //ã‚¿ã‚¤ãƒãƒ¼æ­¢ã‚ã‚‹
                            clearInterval(timerId);
                        }

                        // æ®‹ã‚Šæ™‚é–“ã‚’è¨ˆç®—ã—ã¦è¡¨ç¤º
                        countTime = setTime - second;
                        $('.minute').text(countTime % 3600 / 60 | 0);
                        $('.second').text(countTime % 60);

                        // 1ç§’ã”ã¨ã«ã‚¿ã‚¤ãƒãƒ¼ã‚’æ›´æ–°
                    }, 1000);
                }
                // ã‚¿ã‚¤ãƒãƒ¼é–¢æ•°ã‚’å®Ÿè¡Œ
                timer();
            });


        });

    </script>

    <!-- ################ ã€€ã“ã“ã‹ã‚‰ãƒãƒ£ãƒƒãƒˆã€€ã€€################ -->
    <form>
        <fieldset>
            <legend>ãƒãƒ£ãƒƒãƒˆå…¥åŠ›ç”»é¢</legend>
            <div>
                name: <input type="text" id="name">
            </div>
            <div>
                text: <input type="text" id="text">
            </div>
            <div>
                <button type="button" id="send">send</button>
            </div>

            <input type="file" id="example" multiple>

            <!-- ğŸ‘‡ã“ã“ã«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»åƒã‚’è¿½åŠ ã™ã‚‹ -->
            <div id="preview"></div>
            <!-- ã“ã“ã¾ã§ -->
        </fieldset>
    </form>

    <!-- ãƒ‡ãƒ¼ã‚¿å‡ºåŠ›å ´æ‰€ -->
    <ul id="output">
        <!-- <div id="output" style="overflow: auto; height: 300px;"></div> -->
    </ul>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    <script>
        // æ—¥æ™‚ã‚’ã„ã„æ„Ÿã˜ã®å½¢å¼ã«ã™ã‚‹é–¢æ•°
        function convertTimestampToDatetime(timestamp) {
            const _d = timestamp ? new Date(timestamp * 1000) : new Date();
            const Y = _d.getFullYear();
            const m = (_d.getMonth() + 1).toString().padStart(2, '0');;
            const d = _d.getDate().toString().padStart(2, '0');
            const H = _d.getHours().toString().padStart(2, '0');
            const i = _d.getMinutes().toString().padStart(2, '0');
            const s = _d.getSeconds().toString().padStart(2, '0');
            return `${Y}/${m}/${d} ${H}:${i}:${s}`;
        }
    </script>
    <!-- ä»¥ä¸‹ã«firebaseã®ã‚³ãƒ¼ãƒ‰ã‚’è²¼ã‚Šä»˜ã‘ã‚ˆã† -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-app.js";

        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries


        //ã“ã“ã‹ã‚‰è‡ªåˆ†ã§è¿½åŠ ã™ã‚‹ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼
        import {
            getFirestore,
            collection,//â†ãƒ‘ã‚½ã‚³ãƒ³ã§ã„ã†ãƒ•ã‚©ãƒ«ãƒ€ã¦ããªã‚„ã¤
            addDoc,//â†firebaseã®ãƒ•ã‚©ãƒ«ãƒ€ã«ä¿å­˜ã•ã›ã‚‹æ™‚ã«ä½¿ã†
            serverTimestamp,//â†æ™‚é–“æ—¥æ™‚ã‚’è¡¨ç¤ºã•ã›ã‚‹ãŸã‚ã«GoogleãŒç”¨æ„ã—ãŸã‚‚ã®
            onSnapshot,//â†ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä¸Šã§ãƒ‡ãƒ¼ã‚¿ã®å¤‰æ›´ãŒç™ºç”Ÿã—ãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§{}å†…ã®å‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹ã‚„ã¤

        } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-firestore.js";
        // â†‘ã“ã‚Œã‚’ã‚’æ›¸ã„ã¦ãŠãã“ã¨ã§dbã«å¯¾ã—ã¦ãƒ‡ãƒ¼ã‚¿ã®è¿½åŠ ã‚„å–å¾—ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã€‚(â€»ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯åˆã‚ã›ã‚‹10.11.1ã®ã¨ã“)
        //ã“ã“ã¾ã§ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼

        import {
            getStorage, ref, uploadString, getDownloadURL, uploadBytes
        } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-storage.js";

        import {
            getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged
        } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-auth.js";






        // Your web app's Firebase configuration
        const firebaseConfig = {

            // ################################################
            //â†ã“ã“ã®æƒ…å ±ä¸€ç•ªé‡è¦ã ã‹ã‚‰ã€git addã™ã‚‹å‰ã«æ¶ˆã™ï¼ï¼ï¼
            apiKey: "AIzaSyBEN9vH7Gl7gckY60KvdtnOtlTeQF2Ciy0",
            // #################################################
            authDomain: "chat-app-test-9d30d.firebaseapp.com",
            projectId: "chat-app-test-9d30d",
            storageBucket: "chat-app-test-9d30d.appspot.com",
            messagingSenderId: "779333419143",
            appId: "1:779333419143:web:d3b854ebb27f2b21d23822"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);

        // ã“ã“ã‹ã‚‰è‡ªåˆ†ã§è¿½åŠ ã™ã‚‹ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼
        const db = getFirestore(app);
        // â†‘ã“ã‚Œã‚’ã‚’æ›¸ã„ã¦ãŠãã“ã¨ã§dbã«å¯¾ã—ã¦ãƒ‡ãƒ¼ã‚¿ã®è¿½åŠ ã‚„å–å¾—ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã€‚

        // chatGTPã®æŒ‡ç¤ºã§è¿½åŠ â†“///////////////////////////////
        const storage = getStorage(app);
        ////////////////////////////////////////////////////

        // ###############################
        // GoogleAuthç”¨
        const provider = new GoogleAuthProvider();
        provider.addScope("https://www.googleapis.com/auth/contacts.readonly");
        const auth = getAuth();
        // ################################

        // ###############################
        // loginã—ã¦ã‚Œã°å‡¦ç†ã™ã‚‹
        onAuthStateChanged(auth, (user) => {
            if (user) {
                const uid = user.uid;
                // ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—
                if (user !== null) {
                    user.providerData.forEach((profile) => {
                        // loginæƒ…å ±å–å¾—
                        $("#uname").text(profile.displayName);
                        $("#prof").attr("scr", profile.photoURL);
                        // console.log("Sign-in provider: " + profile.providerId);
                        // console.log("Provider-specific UID: " + profile.uid);
                        // console.log("Email: " + profile.email);
                        // console.log("Photo URL: " + profile.photoURL);

                    });
                    $("#status").fadeOut(500);
                }
            }

            else {
                _redirect(); //ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ãªã‘ã‚Œã°ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã™ã‚‹
            }
        });


        // ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ################################
        function _redirect() {
            location.href = "login_rich.html";  //â†ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã®URLã«å¤‰æ›´
        }



        // â†“functionã®å‰ã€asyncãªã„ã¨awaitãŒèµ¤ãªã¿ã›ã‚“ãªã‚‹ï¼  
        $("#send").on("click", async function () {

            // ã“ã“chatGTPã«èã„ã¦ã‚„ã£ãŸã¨ã“/////////////////////////
            // ç”»åƒãŒé¸æŠã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ã€ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹
            const files = fileInput.files;
            for (let i = 0; i < files.length; i++) {
                const file = files[i];

                const storageRef = ref(storage, 'images/' + file.name);
                await uploadBytes(storageRef, file);

                // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãŸç”»åƒã®URLã‚’å–å¾—
                const imageURL = await getDownloadURL(storageRef);

                // const url = await uploadImag(file);
                // await uploadImage(file);

                const post = {
                    name: $('#name').val(),
                    text: $('#text').val(),
                    time: serverTimestamp(),
                    url: imageURL
                };
                console.log(post);
                addDoc(collection(db, 'chat'), post);
                $('#text').val('');

            }
            // ã“ã“ã¾ã§///////////////////////////////////////////////

        });


        // ãƒ‡ãƒ¼ã‚¿å–å¾—å‡¦ç†â†“databaseã®å†…å®¹ã«å¤‰æ›´ãŒã‚ã£ãŸæ™‚ã¯[onSnapshot]ã‚’ä½¿ã†ï¼ï¼ï¼ï¼ï¼{}å†…ãŒå®Ÿè¡Œã•ã‚Œã‚‹
        onSnapshot(collection(db, "chat"), (querySnapshot) => {
            // console.log(querySnapshot.docs);


            // ---------ã“ã“ã‹ã‚‰è¬›ç¾©è³‡æ–™ï¼–.ï¼—ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼â†‘onSnapshotã®å‡¦ç†å†…ã«è¿½åŠ ã™ã‚‹ï¼ï¼
            // å¿…è¦ãªãƒ‡ãƒ¼ã‚¿ã®ã¿æŠ½å‡ºã—ãŸã€Œã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå½¢å¼ã®é…åˆ—ã€ã«å¤‰æ›
            const documents = [];//ç©ºã®é…åˆ—ã‚’æº–å‚™
            querySnapshot.docs.forEach(function (doc) {
                const document = {
                    id: doc.id,
                    data: doc.data(),
                };
                documents.push(document);
            });

            console.log(documents);

            //é…åˆ—ã‹ã‚‰ç”»é¢è¡¨ç¤ºç”¨ã®ã‚¿ã‚°ã‚’ä½œæˆ
            const htmlElements = [];
            documents.forEach(function (document) {
                htmlElements.push(`
<li id="${document.id}">
    <p>${document.data.name} at ${convertTimestampToDatetime(document.data.Timestamp)}</p>
    <p>${document.data.text}</p>
    <p><img src="${document.data.url}"></p>
</li>
`);
            });

            $("#output").html(htmlElements);//%%%%%%%%%%%%%%%%%%ç”»åƒè¡¨ç¤ºã“ã“ã‚‰ã¸ã‚“ã‹ãªï¼Ÿ


        });
        //â†‘ã“ã“ã¾ã§onSnapshotã®å‡¦ç†ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼



        // ç”»åƒãŒé¸æŠã•ã‚ŒãŸæ™‚ã«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’è¡¨ç¤ºã•ã›ã‚‹å‡¦ç†:å‚è€ƒè³‡æ–™ï¼ˆhttps://catnose.me/learning/html/input-file#google_vignette)
        // <input>ã§ãƒ•ã‚¡ã‚¤ãƒ«ãŒé¸æŠã•ã‚ŒãŸã¨ãã®å‡¦ç†
        const fileInput = document.getElementById('example');
        const handleFileSelect = () => {
            const files = fileInput.files;
            for (let i = 0; i < files.length; i++) {
                previewFile(files[i]);
                // ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼
                // previewFile(file); // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®è¡¨ç¤º
                // uploadImage(file); // ç”»åƒã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å‡¦ç†
                // ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼
            }
        }
        fileInput.addEventListener('change', handleFileSelect);

        // ç”»åƒã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å‡¦ç†
        const uploadImage = async (file) => {
            try {
                // Storageã«ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
                const storageRef = ref(storage, 'images/' + file.name);
                await uploadString(storageRef, file);

                // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãŸç”»åƒã®URLã‚’å–å¾—
                const imageURL = await getDownloadURL(storageRef);
                console.log(imageURL);

                // Firestoreã«ç”»åƒã®URLã‚’ä¿å­˜
                await addDoc(collection(db, 'chat'), { url: imageURL }); //ã“ã“æ©Ÿèƒ½ã—ã¦ãªã„?â†’è§£æ±ºï¼
                //dbã®å¾Œã‚'images'ã‹ã‚‰'chat'ã«å¤‰æ›´ï¼5/8

                console.log('Image uploaded successfully!');
            } catch (error) {
                console.error('Error uploading image:', error);
            }
        };



        function previewFile(file) {
            // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»åƒã‚’è¿½åŠ ã™ã‚‹è¦ç´ 
            const preview = document.getElementById('preview');

            // FileReaderã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
            const reader = new FileReader();

            // ãƒ•ã‚¡ã‚¤ãƒ«ãŒèª­ã¿è¾¼ã¾ã‚ŒãŸã¨ãã«å®Ÿè¡Œã™ã‚‹
            reader.onload = function (e) {
                const imageUrl = e.target.result; // ç”»åƒã®URLã¯event.target.resultã§å‘¼ã³å‡ºã›ã‚‹
                const img = document.createElement("img"); // imgè¦ç´ ã‚’ä½œæˆ
                img.src = imageUrl; // ç”»åƒã®URLã‚’imgè¦ç´ ã«ã‚»ãƒƒãƒˆ
                preview.appendChild(img); // #previewã®ä¸­ã«è¿½åŠ 
            }


            // ã„ã–ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€
            reader.readAsDataURL(file);
        };





    </script>



</body>

</html>








<!-- <script>
    // ç”»é¢ï¼šã‚¿ã‚¤ãƒãƒ¼ç§’æ•°ã€ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã€ä½•ç§’ãŸã£ãŸã‹è¡¨ç¤º
    // ã‚¹ã‚¿ãƒ¼ãƒˆã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
    const time = document.querySelector("#time");
    const sec = document.querySelector("#sec");
    const start = document.querySelector("#start");
    const sound = document.querySelector("#sound");
    let count = 0;  //Countã™ã‚‹å¤‰æ•°=0
    const s = 1000;  //ã‚¿ã‚¤ãƒãƒ¼ç§’æ•°


    start.onclick = function () {
        //â†“clearIntervalã§IDã‚’ä½¿ã†ãŸã‚ã«const set_idã‚’ç”¨æ„
        const set_id = setInterval(function () {
            count++;
            time.innerHTML = count;
            if (count == sec.value) {
                sound.play();
                clearInterval(set_id); //æ™‚é–“ã«ãªã£ãŸã‚‰ã‚¿ã‚¤ãƒãƒ¼æ­¢ã‚ã‚‹
            }
        }, s);  //ï¼‘ç§’ã¥ã¤å›è»¢ã•ã›ã‚‹
    } -->